#!/bin/bash

########################################################
# Fill <ip_list> with your machine ip <ifconfig eth0>
########################################################
declare -a ip_list=(
#172.21.16.24
#172.21.16.13
#172.21.16.22
#172.21.16.26
#172.21.16.28
#172.21.16.30
#172.21.16.46
#172.21.16.49
#172.21.16.12
#172.21.16.3
#172.21.16.10
#172.21.16.16
#172.21.16.33
#172.21.16.37
#172.21.16.8
#172.21.16.2
#172.21.16.15
#172.21.16.47
#172.21.16.46
#172.21.16.28
#172.21.17.48
172.21.16.6
172.21.17.58
)

########################################################
# Adjust the script file path
########################################################
work_dir=$(pwd)

script_path=${1:-deepseek_vllm_start.sh}
model_size=${2:-}

master_ip=${ip_list[0]}
nnodes=${#ip_list[@]}

rank=0
for i in ${ip_list[@]}
do
	echo; echo
	cmd="cd $work_dir; bash $script_path $master_ip $nnodes $rank"
	echo "Running [ $cmd ] on server [ $i ]"
	ssh $i "$cmd" &
	((rank++))
done
